# LLMä¼˜åŒ–æŒ‡å—

## ğŸ¯ æ”¹è¿›ç©ºé—´åˆ†æ

### 1. ç›¸å…³æœ¯è¯­æ•°é‡ä¼˜åŒ–

#### å½“å‰å®ç°ï¼šåŠ¨æ€è°ƒæ•´
```typescript
// é…ç½®æ–‡ä»¶ï¼šsrc/config/llm.config.ts
ç®€å•æŸ¥è¯¢ï¼ˆ<50å­—ç¬¦ï¼‰ï¼š12ä¸ªæœ¯è¯­
ä¸­ç­‰æŸ¥è¯¢ï¼ˆ50-150å­—ç¬¦ï¼‰ï¼š16ä¸ªæœ¯è¯­
å¤æ‚æŸ¥è¯¢ï¼ˆ>150å­—ç¬¦ï¼‰ï¼š20ä¸ªæœ¯è¯­
```

#### ä¼˜ç¼ºç‚¹å¯¹æ¯”

| æœ¯è¯­æ•°é‡ | Tokenæ¶ˆè€— | å‡†ç¡®åº¦ | æˆæœ¬ | å“åº”æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
|---------|----------|--------|------|---------|---------|
| 8ä¸ª | ~1300 | â­â­â­ | ğŸ’° | âš¡âš¡âš¡ | ç®€å•å•ç—‡çŠ¶ |
| 12ä¸ª | ~2000 | â­â­â­â­ | ğŸ’°ğŸ’° | âš¡âš¡ | å¸¸è§„æŸ¥è¯¢ï¼ˆå½“å‰é»˜è®¤ï¼‰ |
| 16ä¸ª | ~2600 | â­â­â­â­ | ğŸ’°ğŸ’°ğŸ’° | âš¡âš¡ | ä¸­ç­‰å¤æ‚åº¦ |
| 20ä¸ª | ~3300 | â­â­â­â­â­ | ğŸ’°ğŸ’°ğŸ’°ğŸ’° | âš¡ | å¤æ‚å¤šç—‡çŠ¶ |
| 30ä¸ª | ~5000 | â­â­â­ | ğŸ’°ğŸ’°ğŸ’°ğŸ’°ğŸ’° | âš¡ | è¿‡å¤šå™ªéŸ³ï¼Œä¸æ¨è |

#### å»ºè®®
- âœ… **ä¿æŒåŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è‡ªé€‚åº”
- âœ… **12-20ä¸ªæ˜¯æœ€ä½³èŒƒå›´**ï¼šå¹³è¡¡å‡†ç¡®åº¦å’Œæˆæœ¬
- âš ï¸ **è¶…è¿‡25ä¸ªä¼šå¼•å…¥å™ªéŸ³**ï¼šåè€Œé™ä½å‡†ç¡®åº¦

---

## ğŸš€ å…¶ä»–ä¼˜åŒ–æ–¹å‘

### 2. Promptå·¥ç¨‹ä¼˜åŒ–

#### å½“å‰Promptç»“æ„
```
System: ä½ æ˜¯ä¸´åºŠé—ä¼ å­¦ä¸“å®¶ + è§„èŒƒ + å‚è€ƒæœ¯è¯­
User: ä¸´åºŠæè¿°
```

#### å¯æ”¹è¿›ç‚¹

**A. Few-shot Learningï¼ˆå°‘æ ·æœ¬å­¦ä¹ ï¼‰**
```typescript
// åœ¨Systemæ¶ˆæ¯ä¸­æ·»åŠ ç¤ºä¾‹
const examples = `
ç¤ºä¾‹1:
è¾“å…¥: æ‚£è€…è¡¨ç°ä¸ºå‘è‚²è¿Ÿç¼“ï¼Œæ™ºåŠ›éšœç¢
è¾“å‡º:
| HP:0001263 | Global developmental delay | å…¨é¢å‘è‚²è¿Ÿç¼“ | é«˜ | ç›´æ¥æè¿° |
| HP:0001249 | Intellectual disability | æ™ºåŠ›éšœç¢ | é«˜ | ç›´æ¥æè¿° |

ç¤ºä¾‹2:
è¾“å…¥: ç™«ç—«å‘ä½œï¼Œé¢éƒ¨ç•¸å½¢
è¾“å‡º:
| HP:0001250 | Seizure | ç™«ç—«å‘ä½œ | é«˜ | ç›´æ¥æè¿° |
| HP:0001999 | Abnormal facial shape | é¢éƒ¨å½¢æ€å¼‚å¸¸ | ä¸­ | éœ€è¿›ä¸€æ­¥æè¿° |
`;
```

**æ•ˆæœ**ï¼šæé«˜è¾“å‡ºæ ¼å¼ä¸€è‡´æ€§ï¼Œå‡å°‘è§£æé”™è¯¯

**æˆæœ¬**ï¼šå¢åŠ ~500 tokens

---

**B. Chain-of-Thoughtï¼ˆæ€ç»´é“¾ï¼‰**
```typescript
// è¦æ±‚LLMå…ˆåˆ†æå†è¾“å‡º
const prompt = `
è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤åˆ†æï¼š
1. è¯†åˆ«å…³é”®ç—‡çŠ¶
2. åŒ¹é…HPOæœ¯è¯­
3. è¯„ä¼°ç½®ä¿¡åº¦
4. è¾“å‡ºè¡¨æ ¼
`;
```

**æ•ˆæœ**ï¼šæé«˜å¤æ‚ç—…ä¾‹çš„å‡†ç¡®åº¦

**æˆæœ¬**ï¼šå¢åŠ å“åº”æ—¶é—´20-30%

---

### 3. æœç´¢ç®—æ³•ä¼˜åŒ–

#### å½“å‰å®ç°
```typescript
// åŸºäºå…³é”®è¯å’Œå‰ç¼€çš„ç´¢å¼•æœç´¢
- IDç´¢å¼•ï¼šO(1)
- å‰ç¼€ç´¢å¼•ï¼šO(log n)
- å…³é”®è¯ç´¢å¼•ï¼šO(log n)
```

#### å¯æ”¹è¿›ç‚¹

**A. è¯­ä¹‰æœç´¢ï¼ˆEmbeddingï¼‰**
```typescript
// ä½¿ç”¨å‘é‡æ•°æ®åº“ï¼ˆå¦‚Milvusã€Qdrantï¼‰
// é¢„å…ˆè®¡ç®—æ‰€æœ‰HPOæœ¯è¯­çš„embedding
// æŸ¥è¯¢æ—¶è®¡ç®—ç›¸ä¼¼åº¦

ä¼˜ç‚¹ï¼š
- æ›´å‡†ç¡®çš„è¯­ä¹‰åŒ¹é…
- èƒ½ç†è§£åŒä¹‰è¯å’Œç›¸å…³æ¦‚å¿µ

ç¼ºç‚¹ï¼š
- éœ€è¦é¢å¤–çš„å‘é‡æ•°æ®åº“
- åˆå§‹åŒ–æ—¶é—´æ›´é•¿
- å¢åŠ ç³»ç»Ÿå¤æ‚åº¦
```

**B. æ··åˆæœç´¢**
```typescript
// ç»“åˆå…³é”®è¯æœç´¢å’Œè¯­ä¹‰æœç´¢
const keywordResults = await keywordSearch(query);
const semanticResults = await semanticSearch(query);
const combined = mergeAndRank(keywordResults, semanticResults);
```

---

### 4. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

#### å½“å‰å®ç°
```typescript
// APIè·¯ç”±å±‚çš„ç®€å•ç¼“å­˜
const requestCache = new Map();
```

#### å¯æ”¹è¿›ç‚¹

**A. å¤šçº§ç¼“å­˜**
```typescript
// L1: å†…å­˜ç¼“å­˜ï¼ˆå½“å‰è¯·æ±‚ï¼‰
// L2: Redisç¼“å­˜ï¼ˆè·¨è¯·æ±‚ï¼‰
// L3: æ•°æ®åº“ç¼“å­˜ï¼ˆæŒä¹…åŒ–ï¼‰

const cache = {
  memory: new Map(),
  redis: redisClient,
  db: database
};
```

**B. æ™ºèƒ½ç¼“å­˜å¤±æ•ˆ**
```typescript
// åŸºäºæŸ¥è¯¢ç›¸ä¼¼åº¦çš„ç¼“å­˜
// ç›¸ä¼¼æŸ¥è¯¢å¯ä»¥å¤ç”¨ç¼“å­˜
function getCacheKey(query: string): string {
  // æ ‡å‡†åŒ–æŸ¥è¯¢
  const normalized = normalizeQuery(query);
  // è®¡ç®—hash
  return hash(normalized);
}
```

---

### 5. å¹¶è¡Œå¤„ç†ä¼˜åŒ–

#### å½“å‰å®ç°
```typescript
// ä¸²è¡Œå¤„ç†
const relevantTerms = await findRelevantTerms(question);
const llmResponse = await callLLM(question, relevantTerms);
```

#### å¯æ”¹è¿›ç‚¹

**A. é¢„çƒ­æœç´¢å¼•æ“**
```typescript
// åœ¨æœåŠ¡å¯åŠ¨æ—¶é¢„å…ˆæ„å»ºç´¢å¼•
// å½“å‰ï¼šé¦–æ¬¡æŸ¥è¯¢æ—¶æ„å»ºï¼ˆ1-3ç§’ï¼‰
// ä¼˜åŒ–åï¼šå¯åŠ¨æ—¶æ„å»ºï¼ŒæŸ¥è¯¢æ—¶ç›´æ¥ä½¿ç”¨
```

**B. æµå¼å“åº”**
```typescript
// ä½¿ç”¨SSEï¼ˆServer-Sent Eventsï¼‰
// è¾¹æ¥æ”¶LLMå“åº”è¾¹è¿”å›ç»™å‰ç«¯
stream: true,
onChunk: (chunk) => {
  sendToClient(chunk);
}
```

---

### 6. è´¨é‡æ§åˆ¶ä¼˜åŒ–

#### å¯æ·»åŠ çš„éªŒè¯

**A. ç½®ä¿¡åº¦é˜ˆå€¼**
```typescript
// è¿‡æ»¤ä½ç½®ä¿¡åº¦ç»“æœ
const results = llmResults.filter(r => 
  r.confidence === 'é«˜' || r.confidence === 'ä¸­'
);
```

**B. æœ¯è¯­å±‚çº§éªŒè¯**
```typescript
// éªŒè¯HPOæœ¯è¯­çš„å±‚çº§å…³ç³»
// ä¾‹å¦‚ï¼šä¸åº”åŒæ—¶è¿”å›çˆ¶æœ¯è¯­å’Œå­æœ¯è¯­
function validateHierarchy(terms: HPOTerm[]): HPOTerm[] {
  // ç§»é™¤å†—ä½™çš„çˆ¶æœ¯è¯­
  return removeRedundantParents(terms);
}
```

**C. å¤šæ¨¡å‹æŠ•ç¥¨**
```typescript
// ä½¿ç”¨å¤šä¸ªLLMæ¨¡å‹ï¼Œå–äº¤é›†
const results1 = await callLLM(query, 'deepseek-v3');
const results2 = await callLLM(query, 'gpt-4');
const consensus = findConsensus(results1, results2);
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å»ºè®®æ·»åŠ çš„æŒ‡æ ‡

```typescript
// åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨
export const Metrics = {
  searchTime: [],        // æœç´¢è€—æ—¶
  llmTime: [],          // LLMè°ƒç”¨è€—æ—¶
  totalTime: [],        // æ€»è€—æ—¶
  accuracy: [],         // å‡†ç¡®åº¦ï¼ˆéœ€äººå·¥æ ‡æ³¨ï¼‰
  cacheHitRate: 0,      // ç¼“å­˜å‘½ä¸­ç‡
  tokenUsage: [],       // Tokenä½¿ç”¨é‡
  cost: [],             // æˆæœ¬
};
```

---

## ğŸ›ï¸ å¿«é€Ÿè°ƒæ•´æŒ‡å—

### æƒ³è¦æ›´é«˜å‡†ç¡®åº¦ï¼Ÿ
```typescript
// src/config/llm.config.ts
relevantTerms: {
  simple: { termCount: 16 },    // 12 â†’ 16
  medium: { termCount: 20 },    // 16 â†’ 20
  complex: { termCount: 25 },   // 20 â†’ 25
}
```

### æƒ³è¦é™ä½æˆæœ¬ï¼Ÿ
```typescript
relevantTerms: {
  simple: { termCount: 8 },     // 12 â†’ 8
  medium: { termCount: 12 },    // 16 â†’ 12
  complex: { termCount: 16 },   // 20 â†’ 16
}
```

### æƒ³è¦å›ºå®šæœ¯è¯­æ•°é‡ï¼Ÿ
```typescript
relevantTerms: {
  fixed: 15,  // å–æ¶ˆæ³¨é‡Šæ­¤è¡Œï¼Œæ‰€æœ‰æŸ¥è¯¢éƒ½ä½¿ç”¨15ä¸ªæœ¯è¯­
}
```

### æƒ³è¦æ›´ç¡®å®šçš„ç»“æœï¼Ÿ
```typescript
apiParams: {
  temperature: 0.1,     // 0.2 â†’ 0.1ï¼ˆæ›´ç¡®å®šï¼‰
  topP: 0.3,           // 0.5 â†’ 0.3ï¼ˆæ›´é›†ä¸­ï¼‰
}
```

### æƒ³è¦æ›´å¤šæ ·çš„ç»“æœï¼Ÿ
```typescript
apiParams: {
  temperature: 0.4,     // 0.2 â†’ 0.4ï¼ˆæ›´å¤šæ ·ï¼‰
  topP: 0.7,           // 0.5 â†’ 0.7ï¼ˆæ›´åˆ†æ•£ï¼‰
}
```

---

## ğŸ“ˆ A/Bæµ‹è¯•å»ºè®®

### æµ‹è¯•æ–¹æ¡ˆ

1. **åŸºçº¿**ï¼ˆå½“å‰é…ç½®ï¼‰
   - æœ¯è¯­æ•°ï¼š12/16/20ï¼ˆåŠ¨æ€ï¼‰
   - Temperature: 0.2

2. **æ–¹æ¡ˆA**ï¼šæ›´å¤šæœ¯è¯­
   - æœ¯è¯­æ•°ï¼š16/20/25ï¼ˆåŠ¨æ€ï¼‰
   - Temperature: 0.2

3. **æ–¹æ¡ˆB**ï¼šæ›´ä½æ¸©åº¦
   - æœ¯è¯­æ•°ï¼š12/16/20ï¼ˆåŠ¨æ€ï¼‰
   - Temperature: 0.1

4. **æ–¹æ¡ˆC**ï¼šå›ºå®šæœ¯è¯­
   - æœ¯è¯­æ•°ï¼š15ï¼ˆå›ºå®šï¼‰
   - Temperature: 0.2

### è¯„ä¼°æŒ‡æ ‡
- âœ… å‡†ç¡®ç‡ï¼šä¸ä¸“å®¶æ ‡æ³¨å¯¹æ¯”
- â±ï¸ å“åº”æ—¶é—´ï¼šå¹³å‡æŸ¥è¯¢æ—¶é—´
- ğŸ’° æˆæœ¬ï¼šæ¯æ¬¡æŸ¥è¯¢çš„tokenæ¶ˆè€—
- ğŸ˜Š ç”¨æˆ·æ»¡æ„åº¦ï¼šä¸»è§‚è¯„ä»·

---

## ğŸ¯ æ¨èé…ç½®

### ç”Ÿäº§ç¯å¢ƒï¼ˆå¹³è¡¡ï¼‰
```typescript
relevantTerms: {
  simple: { termCount: 12 },
  medium: { termCount: 16 },
  complex: { termCount: 20 },
},
apiParams: {
  temperature: 0.2,
  topP: 0.5,
}
```

### é«˜å‡†ç¡®åº¦åœºæ™¯
```typescript
relevantTerms: {
  simple: { termCount: 16 },
  medium: { termCount: 20 },
  complex: { termCount: 25 },
},
apiParams: {
  temperature: 0.1,
  topP: 0.3,
}
```

### ä½æˆæœ¬åœºæ™¯
```typescript
relevantTerms: {
  fixed: 10,  // å›ºå®š10ä¸ªæœ¯è¯­
},
apiParams: {
  temperature: 0.2,
  topP: 0.5,
  maxTokens: 1024,  // å‡å°‘è¾“å‡ºé•¿åº¦
}
```

---

## ğŸ’¡ æ€»ç»“

### å½“å‰ä¼˜åŒ–å·²å®ç°
- âœ… åŠ¨æ€æœ¯è¯­æ•°é‡è°ƒæ•´
- âœ… é«˜æ€§èƒ½ç´¢å¼•æœç´¢
- âœ… æ‰¹é‡æ•°æ®è·å–
- âœ… é…ç½®åŒ–å‚æ•°ç®¡ç†
- âœ… è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

### å»ºè®®çš„ä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
1. **æ·»åŠ Few-shotç¤ºä¾‹**ï¼ˆæé«˜æ ¼å¼ä¸€è‡´æ€§ï¼‰
2. **å®ç°Redisç¼“å­˜**ï¼ˆæé«˜å“åº”é€Ÿåº¦ï¼‰
3. **æ·»åŠ æ€§èƒ½ç›‘æ§**ï¼ˆæ•°æ®é©±åŠ¨ä¼˜åŒ–ï¼‰
4. **å®ç°æµå¼å“åº”**ï¼ˆæ”¹å–„ç”¨æˆ·ä½“éªŒï¼‰
5. **æ¢ç´¢è¯­ä¹‰æœç´¢**ï¼ˆé•¿æœŸæ–¹å‘ï¼‰

### å…³äºå¢åŠ åˆ°20ä¸ªæœ¯è¯­
- âœ… **å·²å®ç°**ï¼šå¤æ‚æŸ¥è¯¢è‡ªåŠ¨ä½¿ç”¨20ä¸ªæœ¯è¯­
- âœ… **å¯è°ƒæ•´**ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­è½»æ¾ä¿®æ”¹
- âš ï¸ **å»ºè®®**ï¼šä¿æŒåŠ¨æ€è°ƒæ•´ï¼Œè€Œä¸æ˜¯å›ºå®š20ä¸ª

---

**é…ç½®æ–‡ä»¶ä½ç½®**: `src/config/llm.config.ts`

**ä¿®æ”¹åè®°å¾—é‡å¯æœåŠ¡å™¨**: `npm run dev`
